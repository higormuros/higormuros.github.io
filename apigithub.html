<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>API GitHub</title>
	</head>
	<body>
		<main>
			<h1>Lista de repositórios</h1>
			<hr>
			Nome de usuário:<input id="pesquisa" type="text"><br>
			Apenas arquivados?<input type="checkbox" id="arquivados"><br>
			Apenas repositórios com descrição?<input type="checkbox" id="descricao"><br>
			Apenas repositórios PHP?<input type="checkbox" id="php"><br>
			Nome do repositório contém:<input id="nome" type="text"><br>
			Ordenar resultados por:
			<select name="cars" id="ordenar">
				<option value="">Nenhum critério</option>
				<option value="?sort=updated&direction=desc">Data de atualização</option>
				<option value="?sort=name&direction=asc">Nome do repositório</option>
			</select><br>
			<input type="button" onclick="getApiGitHub(pesquisa.value)" value="Pesquisar">
			<br>
			<hr>
			<br>
			<div id="repositorios"></div> 
		</main>
	  
		<script>
		const repositorios = document.querySelector('#repositorios')

		function getApiGitHub(myuser) {
			repositorios.innerHTML="";
			if(myuser.length == 0){
				myuser="higormuros"
			}
			fetch('https://api.github.com/users/'+myuser+'/repos'+document.querySelector("#ordenar").value)
				.then(async res => {

					if(!res.ok) {
						throw new Error(res.status)
					}
					
					var ordem = 1
					var data = await res.json()
					var arquivado = document.querySelector("#arquivados").checked
					var descricao = document.querySelector("#descricao").checked
					var php = document.querySelector("#php").checked
					var nome = document.querySelector("#nome").value
					
					data.map(item => {
						let div = document.createElement('div')

						div.innerHTML = `
						<strong>Repositório ${" "+ordem+": "+item.name.toUpperCase()}</strong>
						<div>URL: <a href="${item.html_url}" target="_blank">${item.html_url}</a></div>
						<div>Data de atualização: 
							${item.updated_at}
						</div>
						<div>Linguagem: 
							${item.language}
						</div>
						<div>Descrição: 
							${item.description}
						</div>
						<br>`
						if(
							(arquivado && item.archived) ||
							(descricao && item.description==null) ||
							(php && item.language!="PHP") ||
							(nome.length > 0 && !item.name.toUpperCase().includes(nome.toUpperCase()))
						){
							div.innerHTML = ""
						}
						repositorios.appendChild(div)
						ordem+=1

					})

				}).catch(e => console.log(e))
		}

		</script>
	</body>
</html>